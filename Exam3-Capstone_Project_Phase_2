import java.util.HashMap;

public class LRUCache<K, V> {

    // Node for doubly linked list
    private class Node {
        K key;
        V value;
        Node prev;
        Node next;

        Node(K k, V v) {
            key = k;
            value = v;
        }
    }

    private final int capacity;
    private final HashMap<K, Node> map;
    private Node head;
    private Node tail;

    public LRUCache(int capacity) {
        this.capacity = capacity;
        this.map = new HashMap<>();
    }

    // Retrieves a value and moves the node to the front
    public V get(K key) {
        if (!map.containsKey(key))
            return null;

        Node node = map.get(key);
        moveToFront(node);
        return node.value;
    }

    // Inserts or updates a key-value pair
    public void put(K key, V value) {
        if (map.containsKey(key)) {
            Node existing = map.get(key);
            existing.value = value;
            moveToFront(existing);
            return;
        }

        if (map.size() == capacity) {
            evictLeastUsed();
        }

        Node newNode = new Node(key, value);
        addToFront(newNode);
        map.put(key, newNode);
    }

    // Moves a node to the head (most recently used)
    private void moveToFront(Node node) {
        removeNode(node);
        addToFront(node);
    }

    // Adds a node to the head of the list
    private void addToFront(Node node) {
        node.prev = null;
        node.next = head;

        if (head != null)
            head.prev = node;

        head = node;

        if (tail == null)
            tail = node;
    }

    // Removes a node from its current position
    private void removeNode(Node node) {
        if (node.prev != null)
            node.prev.next = node.next;
        else
            head = node.next;

        if (node.next != null)
            node.next.prev = node.prev;
        else
            tail = node.prev;
    }

    // Removes the least recently used item
    private void evictLeastUsed() {
        if (tail != null) {
            map.remove(tail.key);
            removeNode(tail);
        }
    }
}

public class LRUDriver {
    public static void main(String[] args) {

        LRUCache<Integer, String> cache = new LRUCache<>(3);

        cache.put(1, "A");
        cache.put(2, "B");
        cache.put(3, "C");

        System.out.println(cache.get(1)); // A

        cache.put(4, "D"); // Evicts key 2 (LRU)

        System.out.println(cache.get(2)); // null
        System.out.println(cache.get(3)); // C
    }
}
